# -*- eval: (add-hook 'after-save-hook (lambda ()(org-babel-tangle)) nil t) -*-
#+TITLE: Preámbulo de LaTeX (Artículo)
#+SUBTITLE: Una configuración que usa la clase article y LuaLaTeX
#+AUTHOR: Jhonny Lanzuisi
#+TAGS: :latex:preamble:
#+PROPERTY: header-args :exports code :tangle preamble-article.tex
#+SETUPFILE: /home/jhonny/git/org-mode/style.css.org
#+LATEX_HEADER: \lstset{language=TeX}\asignatura{Tipografía en TeX}

# LICENSE: See license notice bellow

#+BEGIN_SRC latex :exports none
%----README----
% This TeX file was automatically generated by GNU Emacs's Org Mode.
% For better documentation refer to the corresponding Org file, 
% which you can find in the sources specified bellow.
% Do keep in mind that this file undergoes little to none manual revision.
%----LICENSE---
% Copyright 2021 Jhonny Lanzuisi (jalb97@gmail.com)
% More source files at github.com/JLanzuisi
%
% This program is free software: you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation, either version 3 of the License, or
% (at your option) any later version.
%
% This program is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
% GNU General Public License for more details.
%
% You should have received a copy of the GNU General Public License
% along with this program.  If not, see <https://www.gnu.org/licenses/>.
%--------------
#+END_SRC

* Configuraciones varias de TeX
Esta parte hace que TeX no reporte overfull (o underfull) boxes si son muy pequeñas.
Además, hace la marca de una overfull más grande, para que sea más fácil de ver.

#+BEGIN_SRC latex
\hfuzz1pc
\overfullrule=2cm
#+END_SRC

* Configuración de idioma
Aquí de configura el español, junto con una opción para que los párrafos que siguen a un título no estén identados.

#+BEGIN_SRC latex
\usepackage[spanish,es-noindentfirst]{babel}
\usepackage{csquotes}
#+END_SRC

* Dimensiones de la página
Los márgenes se configuran aquí. Junto con el tamaño del papel, actualmente en carta.

#+BEGIN_SRC latex
\usepackage
[
	includehead,
	includefoot,
	top=.5cm,
	bottom=.5cm,
	left=1.7cm,
	right=7.3cm,
	marginparsep=0.5cm,
	marginparwidth=7cm,
]
{geometry}
#+END_SRC

* Tipografías (texto y matemáticas)
Primero cargamos los paquetes de la AMS para tener algunos símbolos y entornos útiles.
También se definen algunos operadores.

#+BEGIN_SRC latex
\usepackage{mathtools}
\DeclareMathOperator{\Rea}{Re}
\DeclareMathOperator{\Ima}{Im}
\DeclareMathOperator{\car}{car}
\DeclareMathOperator{\traz}{tr}
\DeclareMathOperator{\gen}{gen}
\DeclareMathOperator{\mcm}{mcm}
#+END_SRC

Las fuentes utilizan el paquete =fontspec=, por lo que =lualatex= o =xelatex= son necesarios.
Además, dado que =unicode-math= carga =fontspec= por defecto, es suficiente con:

#+BEGIN_SRC latex
\usepackage{unicode-math}
#+END_SRC

Ahora, si, las fuentes del texto.
Se usan por defecto números proporcionales y "oldstyle".

#+BEGIN_SRC latex
\setmainfont{New Computer Modern Book}
\defaultfontfeatures{Scale=MatchLowercase}
\setsansfont{Public Sans}
\setmonofont{Average Mono}
\newcommand{\headfont}{\sffamily}
#+END_SRC

Algo de espacio entre las lineas. El comando =\frenchspacing= hace que LaTeX coloque un solo espacio después de los puntos.

#+BEGIN_SRC latex
\frenchspacing
\linespread{1.05}
#+END_SRC

Las fuentes de matemáticas estan basadas en Times Roman,
mas que nada para ser consistente con la versión HTML.

#+BEGIN_SRC latex
\setmathfont{New Computer Modern Math}
#+END_SRC

Y por último, ajustes microtipográficos.

#+BEGIN_SRC latex
\usepackage[final]{microtype}
#+END_SRC

* Paquetes varios
Primero, un línea que permite cargar las imágenes del documente según hagan falta.
Esto se hace pasando la opción "borrador" al paquete que se encarga de las imágenes.
Luego, una opción para poder usar los nombres de los colores en =xcolor=.

#+BEGIN_SRC latex
\PassOptionsToPackage{final}{graphicx}
\PassOptionsToPackage{dvipsnames}{xcolor}
#+END_SRC

Ahora, diversos paquetes útiles o que sirven de dependencias a otros.
La mayoría son fáciles de entender, en cualquier caso chequeen la documentación individual de cada paquete (en GNU/Linux, con TeXLive, =texdoc $package-name=).

#+BEGIN_SRC latex
\usepackage
{
	xcolor,
	graphicx,
	cancel,
	booktabs,
	hyphenat,
	authoraftertitle,
	pdfpages,
	metalogo
}
#+END_SRC

* Referencias y bibliografía
El siguiente bloque configura el estylo de la bibliografía,
y además especifica el comando =biber= para procesar los archivos,
evidentemente hará falat tener =biber= instalado para usarlo.
La línea que especifica el lugar del archi =.bib= debe ser editada, evidentemente, si no se tiene una estructura de archivos idéntica.

#+BEGIN_SRC latex
\usepackage
[
backend=biber,
backref=true,
citestyle=authoryear-comp,
style=chicago-authordate ,
sorting=ynt
]
{biblatex}
\addbibresource{/home/jhonny/git/Misc-LaTeX-files/bib/general.bib}
#+END_SRC
Nótese la opción =backref=true=, que permite hacer referencias desde la página de la bibliografía al texto.

Ahora, se configura la apriencia de las referencias y los url.
El paquete =cleveref= es bastante ùtil.

#+BEGIN_SRC latex
\usepackage{url} 
\usepackage{hyperref} 
\definecolor{Carmine}{HTML}{960018}
\newcommand{\linkcolor}{Carmine}
\hypersetup
{
colorlinks=true,
linkcolor=\linkcolor,
urlcolor=\linkcolor,
citecolor=\linkcolor
}
\usepackage[spanish,nameinlink]{cleveref} 
#+END_SRC

* Notas al márgen
Esta parte define los comandos para añadir notas al margen.
Primero, un nuevo comando que sirve como "variable" para elegir la fuente a usar en el margen =marfont=.

#+BEGIN_src latex
\newcommand{\marfont}{} 
#+END_src

Ahora, cambiamos el comando =marginpar= para que use esa fuente,
y este alineado a la izquierda.

#+BEGIN_SRC latex
%\renewcommand*{\marginfont}{\marfont}
\let\oldmarginpar\marginpar
\renewcommand
	{\marginpar}
	[1]
	{
	\oldmarginpar{\raggedright\marfont #1}
	}
#+END_SRC

El siguiente es un comando que inserta notas al margen numeradas.

#+BEGIN_SRC latex
\newcounter{nota}
\newcommand
	{\nota}
	[1]
	{
	\refstepcounter{nota}\textsuperscript{\thenota}
	\marginpar{
		\raggedright\itshape\thenota. #1
		}
	}
#+END_SRC

Por último, que el comando =footnote= sea lo mismo que =nota=, para que el documento TeX sea mas portable.

#+BEGIN_SRC latex
\renewcommand{\footnote}{\nota}
#+END_SRC

* Listas
Este bloque se encarga de la apriencia de las listas, nada mas.

#+BEGIN_SRC latex
\usepackage{enumitem} 
\setlist[enumerate]{left=-11pt,nosep}
\setlist[description]{font=\normalfont,leftmargin=\parindent}
\setlist[itemize]{label={\small\textbullet},left=-11pt}
#+END_SRC

* Redefinir el comando =maketitle=
Un comando para el título diferente, se puede ignorar y usar el valor por defecto.
Antes, hace falta una manera de establecer para cual asignatura se esta escribiendo,
de eso se encarga el siguiente bloque.

#+BEGIN_SRC latex
\newcommand{\Asignatura}{}
\newcommand
	{\asignatura}
	[1]
	{\renewcommand{\Asignatura}{#1}}
#+END_SRC

Ahora si, la definicón de =maketitle=

#+BEGIN_SRC latex
\makeatletter
\def\@maketitle
	{
	\newpage
	\null
	\let \footnote \thanks
  	\begin{flushleft}\sffamily
  	\marginpar
		{
		\vspace*{.2em}
		\begin{minipage}{.7\marginparwidth}
		\begin{center}
		\includegraphics
			[width=.35\marginparwidth]
			{/home/jhonny/git/LaTeX-University/usb-logo.png}\\
		Universidad Simón Bolívar\\
		Caracas, Venezuela\\
		\end{center}
		\end{minipage}
		}
	{
	\Large\headfont
		\MyTitle
	\par
	}
	\smallskip
	\Asignatura\par
	\smallskip
	\@author,\ \today.
	\end{flushleft}
	\vskip 1.5\baselineskip
	}
\makeatother
#+END_SRC
* Bloques de código (PDF)

La apaciencia de los bloques de código, dando resaltado a la sintaxis, se configura a continuación.
Esto de cuanto programe un poco de =R=, por eso es el único lenguaje.
Escribir código en LaTeX es en general incómodo, solo es recomendable cuando no queda otra opción.
Se pueden colocar varios =lsset= para configurar man lenguajes.

#+BEGIN_SRC latex
\usepackage[final]{listings} 
\lstset
{
numbers=left, numberstyle=\tiny\ttfamily, stepnumber=2, numbersep=5pt, 
basicstyle=\ttfamily, 
stringstyle=\ttfamily,
commentstyle=\itshape,
breaklines=true,
postbreak=\mbox{$\hookrightarrow$\enspace},
columns=flexible
}
#+END_SRC

* Leyendas para figuras y tablas
La apariencia de las leyendas. Nada interesante.

#+BEGIN_SRC latex
\usepackage{caption} 
\captionsetup
{
font={rm},
justification=raggedright,
singlelinecheck=false,
skip=3pt
}
#+END_SRC

* Títulos de secciones y la lista de contenidos
Los paquetes =titlesec= y =titletoc= pueden llegar a ser bastante confusos.
Lamentablemente no hay mejor manera que ver la documentación original,
sin la cual lo siguiente seguramente será ininteligible.

El paquete en cuestión, con una opción para describir con mayor dellate el formato.

#+BEGIN_SRC latex
\usepackage[explicit]{titlesec}
#+END_SRC

Ahora, la configuración de las secciones y subsecciones; en ese orden.

#+BEGIN_SRC latex
\titleformat{\section}[hang]
	{\flushleft\headfont}
	{\addfontfeatures{Numbers=Lining}\thesection}
	{1em}
	{\addfontfeatures{LetterSpace=5}\MakeUppercase{#1}}
	[]
\titlespacing*{\section}
	{0em}
	{1.5\baselineskip}
	{.5\baselineskip}
\titleformat{\subsection}
	{\flushleft\sffamily}
	{\addfontfeatures{Numbers=Lining}\thesubsection}
	{.5em}
	{#1}
	[]
\titlespacing*{\subsection}
	{0em}
	{1\baselineskip}
	{1\baselineskip}
\titleformat{\paragraph}[runin]
	{\scshape}
	{}
	{0em}
	{\MakeLowercase{#1}}
	[.]
\titlespacing*{\paragraph}
	{0em}
	{1\baselineskip}
	{5pt}
#+END_SRC

La siguiente parte configura la lista de contenidos, y sigue el mismo orden que la anterior.

#+BEGIN_SRC latex
\let\oldtoc\tableofcontents
\renewcommand
{\tableofcontents}
{\marginpar{\bigskip\oldtoc}}
\usepackage{titletoc}
#+END_SRC

#+BEGIN_SRC latex
\titlecontents{section}
	[0em]
	{\vspace{0pt}}
	{\contentsmargin{0pt}}
	{\contentsmargin{0pt}}
	{\contentspage}
	[\vspace{.3em}]
\titlecontents{subsection}
	[1.5em]                              
	{\vspace{0pt}}
	{\contentsmargin{0pt}\small}
	{\contentsmargin{0pt}\small}        
	{\small\contentspage}                 
	[\vspace{.3em}]
#+END_SRC

* Encabezados y pies de página
Es normalmente recomendado usar para esto una clase de =koma-script=,
y probablemente sea lo que haga en un futuro, por ahora funciona.

El paquete que se encarga de todo.

#+BEGIN_SRC latex
\usepackage{fancyhdr}
#+END_SRC

Ahora, que no haya una linea horizontal en los encabezados, 
y además ahcerlos suficientemente grandes.

#+BEGIN_SRC latex
\renewcommand{\headrulewidth}{0pt}
\setlength{\headheight}{14pt}
#+END_SRC

Ahora si, al configuración.
La construcción =if... else...= permite colocar cosas diferentes en las páginas pares e impares.
#+BEGIN_SRC latex
\pagestyle{fancy}
\fancyhf{}
\fancyhead
	[L]
	{
	\ifodd\value{page}\MyTitle\else\Asignatura\fi
	}
\fancyhead[R]{\thepage}
\fancypagestyle
	{plain}
	{
	\fancyhead[R]{}
	\fancyhead[L]{}
	\fancyfoot[R]{}%
	\fancyfoot[L]{}
	\fancyfoot[C]{}
	}
#+END_SRC

* Entornos de teoremas
Declaración y configuración de los entornos de teoremas.
Para esto, usamos el siguiente paquete.

#+BEGIN_SRC latex
\usepackage[thmmarks]{ntheorem}
  % \usepackage[thmmarks]{ntheorem}
  % 	\theoremstyle{plain}
  % 	\theoremindent0cm
  % 	\theorempreskip{0cm}
  % 	\theorempostskip{0cm}
  % 	\theoremheaderfont{\hspace*{\parindent}\upshape}
  % 	\theorembodyfont{\itshape}
  % 	\theoremseparator{.}
  % 	\newtheorem{teo}{Teorema}[section]
  % 	\newtheorem{cor}{Corolario}[teo]
  % 	\newtheorem{prop}{Proposición}[section]
  % 	\newtheorem{lem}{Lema}[section]
  % 	\theoremstyle{nonumberplain}
  % 	\theoremheaderfont{\normalfont}
  % 	\theorembodyfont{\upshape}
  % 	\newtheorem{proof}{Demostración}
  % 	\theoremstyle{plain}
  % 	\theorempreskip{1em}
  % 	\theorempostskip{1em}
  % 	\theoremheaderfont{\upshape}
  % 	\theorempostwork{\noindent}
  % 	\newtheorem{definition}{Definición}[section]
#+END_SRC

Ahora, los entornos numerados.

#+BEGIN_SRC latex
\theoremstyle{plain}
\theorempreskip{\medskipamount}
\theorempostskip{\medskipamount}
\theorembodyfont{\upshape}
\theoremseparator{.}
{
\theoremheaderfont{\itshape}
\newtheorem{definition}{Definición}
}
{
\theoremheaderfont{\scshape}
\newtheorem{theorem}{Teorema}
}
#+END_SRC